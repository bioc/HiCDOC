<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>A and B compartments detection and differences across conditions. — detectCompartments • HiCDOC</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="A and B compartments detection and differences across conditions. — detectCompartments" />
<meta property="og:description" content="Detects compartments for each genomic position in each condition, and
computes p-values for compartment differences between conditions." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HiCDOC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/HiCDOC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mzytnicki/HiCDOC/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>A and B compartments detection and differences across conditions.</h1>
    <small class="dont-index">Source: <a href='https://github.com/mzytnicki/HiCDOC/blob/master/R/detectCompartments.R'><code>R/detectCompartments.R</code></a></small>
    <div class="hidden name"><code>detectCompartments.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Detects compartments for each genomic position in each condition, and
computes p-values for compartment differences between conditions.</p>
    </div>

    <pre class="usage"><span class='fu'>detectCompartments</span><span class='op'>(</span>
    <span class='va'>object</span>,
    parallel <span class='op'>=</span> <span class='cn'>TRUE</span>,
    kMeansDelta <span class='op'>=</span> <span class='cn'>NULL</span>,
    kMeansIterations <span class='op'>=</span> <span class='cn'>NULL</span>,
    kMeansRestarts <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>A <code><a href='HiCDOCDataSet-class.html'>HiCDOCDataSet</a></code>.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Whether or not to parallelize the processing. Defaults to TRUE.
See 'Details'.</p></td>
    </tr>
    <tr>
      <th>kMeansDelta</th>
      <td><p>The convergence stop criterion for the clustering. When the centroids'
distances between two iterations is lower than this value, the clustering
stops. Defaults to <code>object$kMeansDelta</code> which is originally set to
<code>defaultHiCDOCParameters$kMeansDelta</code> = 0.0001.</p></td>
    </tr>
    <tr>
      <th>kMeansIterations</th>
      <td><p>The maximum number of iterations during clustering. Defaults to
<code>object$kMeansIterations</code> which is originally set to
<code>defaultHiCDOCParameters$kMeansIterations</code> = 50.</p></td>
    </tr>
    <tr>
      <th>kMeansRestarts</th>
      <td><p>The amount of times the clustering is restarted. For each restart, the
clustering iterates until convergence or reaching the maximum number of
iterations. The clustering that minimizes inner-cluster variance is selected.
Defaults to <code>object$kMeansRestarts</code> which is originally set to
<code>defaultHiCDOCParameters$kMeansRestarts</code> = 20.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code><a href='HiCDOCDataSet-class.html'>HiCDOCDataSet</a></code>, with compartments, concordances, distances,
centroids, and differences.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Genomic positions clustering</h3>
<p>To clusterize genomic positions, the algorithm follows these steps:</p><ol>
<li><p>For each chromosome and condition, get the interaction vectors of
            each genomic position. Each genomic position can have multiple
            interaction vectors, corresponding to the multiple replicates in
            that condition.</p></li>
<li><p>For each chromosome and condition, use constrained K-means to
            clusterize the interaction vectors, forcing replicate interaction
            vectors into the same cluster. The euclidean distance between
            interaction vectors determines their similarity.</p></li>
<li><p>For each interaction vector, compute its concordance, which is
            the confidence in its assigned cluster. Mathematically, it is the
            log ratio of its distance to each centroid, normalized by the
            distance between both centroids, and min-maxed to a [-1,1]
            interval.</p></li>
<li><p>For each chromosome, compute the distance between all centroids
            and the centroids of the first condition. The cross-condition
            clusters whose centroids are closest are given the same cluster
            label. This results in two clusters per chromosome, spanning all
            conditions.</p></li>
</ol>

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>A/B compartments prediction</h3>
<p>To match each cluster with an A or B compartment, the algorithm follows these
steps:</p><ol>
<li><p>For each genomic position, compute its self interaction ratio,
            which is the difference between its self interaction and the
            median of its other interactions.</p></li>
<li><p>For each chromosome, for each cluster, get the median self
            interaction ratio of the genomic positions in that cluster.</p></li>
<li><p>For each chromosome, the cluster with the smallest median self
            interaction ratio is matched with compartment A, and the cluster
            with the greatest median self interaction ratio is matched with
            compartment B. Compartment A being open, there are more overall
            interactions between distant genomic positions, so it is assumed
            that the difference between self interactions and other
            interactions is lower than in compartment B.</p></li>
</ol>

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Significant differences detection</h3>
<p>To find significant compartment differences across conditions, and compute
their p-values, the algorithm follows three steps:</p><ol>
<li><p>For each pair of replicates in different conditions, for each
            genomic position, compute the absolute difference between its
            concordances.</p></li>
<li><p>For each pair of conditions, for each genomic position, compute
            the median of its concordance differences.</p></li>
<li><p>For each pair of conditions, for each genomic position whose
            assigned compartment switches, rank its median against the
            empirical cumulative distribution of medians of all non-switching
            positions in that condition pair. Adjust the resulting p-value
            with the Benjamini–Hochberg procedure.</p></li>
</ol>

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Parallel processing</h3>
<p>The parallel version of detectCompartments uses the
<code><a href='https://rdrr.io/pkg/BiocParallel/man/bpmapply.html'>bpmapply</a></code> function. Before to call the
function in parallel you should specify the parallel parameters such as:</p><ul>
<li><p>On Linux:             <code>multiParam &lt;- BiocParallel::MulticoreParam(workers = 10)</code></p></li>
<li><p>On Windows:             <code>multiParam &lt;- BiocParallel::SnowParam(workers = 10)</code></p></li>
</ul><p>And then you can register the parameters to be used by BiocParallel:</p>
<p><code><a href='https://rdrr.io/pkg/BiocParallel/man/register.html'>BiocParallel::register(multiParam, default = TRUE)</a></code></p>
<p>You should be aware that using MulticoreParam, reproducibility of the
    detectCompartments function using a RNGseed may not work. See this
    <a href='https://github.com/Bioconductor/BiocParallel/issues/122'>issue</a>
    for more details.</p>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>exampleHiCDOCDataSet</span><span class='op'>)</span>
<span class='co'>## Run all filtering and normalization steps (not run for timing reasons)</span>
<span class='co'># object &lt;- filterSmallChromosomes(exampleHiCDOCDataSet)</span>
<span class='co'># object &lt;- filterSparseReplicates(object)</span>
<span class='co'># object &lt;- filterWeakPositions(object)</span>
<span class='co'># object &lt;- normalizeTechnicalBiases(object)</span>
<span class='co'># object &lt;- normalizeBiologicalBiases(object)</span>
<span class='co'># object &lt;- normalizeDistanceEffect(object)</span>

<span class='co'># Detect compartments and differences across conditions</span>
<span class='va'>object</span> <span class='op'>&lt;-</span> <span class='fu'>detectCompartments</span><span class='op'>(</span><span class='va'>exampleHiCDOCDataSet</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Clustering genomic positions.</span></div><div class='output co'>#&gt; <span class='message'>Predicting A/B compartments.</span></div><div class='output co'>#&gt; <span class='message'>Detecting significant differences.</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Kurylo Cyril, Zytnicki Matthias, Foissac Sylvain, Maigné Élise.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


